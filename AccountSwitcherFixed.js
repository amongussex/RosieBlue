function le(e){window.enmity.plugins.registerPlugin(e)}function se(e,n){return window.enmity.modules.getModule(e,n)}function O(...e){return window.enmity.modules.getByProps(...e)}function U(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function me(e){return window.enmity.patcher.create(e)}var ue="AccountSwitcher",de="1.0.6",ge="Switch between multiple accounts.",he="#64D3FF",ye=[{name:"atyanex",id:"1009909324010749954"}],v={name:ue,version:de,description:ge,color:he,authors:ye};function Y(e,n,r){return window.enmity.utilities.findInReactTree(e,n,r)}const I=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars;const we=window.enmity.modules.common.Native,t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const $=window.enmity.modules.common.Toasts,K=window.enmity.modules.common.Dialog,b=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const pe=window.enmity.modules.common.Users,k=window.enmity.modules.common.Navigation,C=window.enmity.modules.common.NavigationNative,X=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const N=window.enmity.modules.common.StyleSheet,z=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const T=window.enmity.modules.common.Locale,Se=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const Ee=window.enmity.modules.common.Scenes;window.enmity.modules.common.Moment;const{components:o}=window.enmity,Ae=o.Alert,fe=o.Button;o.FlatList;const H=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable;const Ce=o.RefreshControl,Te=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const S=o.Text;o.TextInput,o.TouchableHighlight;const x=o.TouchableOpacity;o.TouchableWithoutFeedback,o.Touchable;const g=o.View;o.VirtualizedList,o.Form;const q=o.FormArrow;o.FormCTA;const Re=o.FormCTAButton;o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const F=o.FormInput;o.FormLabel,o.FormRadio;const p=o.FormRow;o.FormSection,o.FormSelect,o.FormSubLabel,o.FormSwitch,o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;function R(e){return window.enmity.assets.getIDByName(e)}const j=O("loginToken"),{default:G}=se(e=>e==null?void 0:e.ButtonColors),J=e=>e.id?{id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar,...e.email&&{email:e.email},...e.phone&&{phone:e.phone}}:{};async function Q(e){const n=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return J(n)}const ve=()=>{const e=()=>{j.logout()};K.show({isDismissable:!0,title:T.Messages.LOGOUT,body:T.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:T.Messages.LOGOUT,cancelText:T.Messages.CANCEL,onConfirm:e})},Z=({title:e="Are you sure?",body:n,confirmColor:r,confirmText:i="Yes",cancelText:s="No",onConfirm:a,onCancel:c})=>{if(!b.getToken())return Ae.alert(e,n,[{text:i,onPress:a},{text:s,onPress:c}]);K.show({isDismissable:!0,title:e,body:n,confirmColor:r,confirmText:i,cancelText:s,onConfirm:a,onCancel:c})},E={AddWhite:R("add_white"),Checkmark:R("Check"),Key:R("ic_authed_apps_24px"),MyAccount:R("ic_my_account_24px"),Passport:R("ic_passport_24px"),Settings:R("settings"),TrashFilled:R("ic_trash_filled_16px"),Sort:R("ic_sort")},ee=O("openLazy","hideActionSheet"),V=O("hex2int"),Ie=U("CustomColorPickerActionSheet"),te=({onSelect:e,defaultColor:n="#000000",resetText:r=T.Messages.RESET})=>{const i=V.hex2int(n);ee.openLazy(()=>Promise.resolve(Ie),"CustomColorPicker",{color:i,onSelect:e,resetText:r,resetColor:i})};function M(e,n){return window.enmity.settings.connectComponent(e,n)}const{ThemeColorMap:ne}=z;function be({account:e}){if(!e)return null;const n=N.createThemedStyleSheet({linkless:{color:ne.HEADER_SECONDARY,fontFamily:I.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:ne.HEADER_PRIMARY,fontFamily:I.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(g,null,(r=>typeof r=="string"?t.createElement(S,{style:n.linkless},r):typeof r=="object"&&r.username&&!r.id?t.createElement(S,{style:n.linkless},r.username):typeof r=="object"&&r.username&&r.id?t.createElement(x,{key:r.id,onPress:()=>Se.showUserProfile({userId:r.id})},t.createElement(S,{style:n.link},r.username)):null)(e))}const{ThemeColorMap:B}=z,{RNCPushNotificationIOS:ke}=we;function Fe({account:e,position:n,settings:r,navigation:i}){var s,a;const c=N.createThemedStyleSheet({container:{backgroundColor:B.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(s=e.color)!=null?s:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:B.HEADER_PRIMARY,fontFamily:I.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:B.HEADER_SECONDARY,fontFamily:I.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:B.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:B.INTERACTIVE_NORMAL}});return t.createElement(x,{style:c.container,onPress:()=>{const l=()=>{k.popAll(),ke.abandonPermissions(),j.loginToken(e.token),$.open({content:`Switched to ${e.user.username}`,source:E.Checkmark})};Z({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:l})}},t.createElement(g,null,t.createElement(p,{label:()=>t.createElement(g,{style:c.info},e.label&&t.createElement(S,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(be,{account:e.user}),e.label&&t.createElement(S,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(g,{style:c.actions},t.createElement(x,{style:c.delete,onPress:()=>{i.navigate("AccountSwitcherEditAccount",{account:e,position:n})}},t.createElement(H,{style:c.settingsIcon,source:E.Settings})),t.createElement(x,{style:c.delete,onPress:()=>{const l=()=>{const m=r.get("accounts",[]);m.splice(n,1),r.set("accounts",m),$.open({content:"Account Deleted",source:E.Checkmark})};Z({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:l})}},t.createElement(H,{style:c.trashIcon,source:E.TrashFilled})))})),t.createElement(g,{style:c.content},t.createElement(S,{style:c.description},(a=e.description)!=null?a:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:Me}=N;var Pe=({settings:e,navigation:n})=>{const[r,i]=t.useState(!1),s=()=>{const m=e.get("accounts",[]);return Array.isArray(m)&&m.sort((d,y)=>{var h,f;return((h=d.label)==null?void 0:h.localeCompare(y.label))||((f=d.username)==null?void 0:f.localeCompare(y.username))})},[a,c]=t.useState(s()),l=Me({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(g,{style:l.container},t.createElement(Te,{style:l.container,refreshControl:t.createElement(Ce,{refreshing:r,onRefresh:()=>{i(!0),c(s()),i(!1)}})},Array.isArray(a)&&a.map((m,d)=>t.createElement(Fe,{account:m,position:d,settings:e,navigation:n})),t.createElement(p,{label:"Add Account (Token)",leading:t.createElement(p.Icon,{source:E.Key}),onPress:()=>{n.navigate("AccountSwitcherAddAccount")}}),Boolean(b.getToken())&&t.createElement(p,{label:"Add Current Account",leading:t.createElement(p.Icon,{source:E.MyAccount}),onPress:()=>{n.navigate("AccountSwitcherAddAccount",{token:b.getToken(),user:J(pe.getCurrentUser())})}}),t.createElement(p,{label:"Add Account (User/Pass)",leading:t.createElement(p.Icon,{source:E.Passport}),onPress:()=>{Boolean(b.getToken())&&j.loginToken(""),k.popAll()}}),Boolean(b.getToken())&&t.createElement(Re,{color:"danger",label:T.Messages.LOGOUT,onPress:ve}))))};const D=X.createStackNavigator(),{createThemedStyleSheet:L}=N,{ThemeColorMap:A}=z;function oe({navigation:e=C.useNavigation()}){const n=L({header:{tintColor:A.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(x,{styles:n.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount")}},t.createElement(H,{style:n.header,source:E.AddWhite}))}function re({settings:e,navigation:n=C.useNavigation(),route:r=C.useRoute()}){const{account:i,position:s}=r.params,[a,c]=t.useState(i.token),[l,m]=t.useState(i.label||""),[d,y]=t.useState(i.description||""),[h,f]=t.useState(i.color||"#524FBF"),w=L({container:{flex:1,padding:16},colorBlock:{minWidth:24,height:24,borderRadius:3,marginHorizontal:0,marginVertical:0,marginRight:8,justifyContent:"center",alignItems:"center"},colorText:{fontFamily:I.Fonts.PRIMARY_SEMIBOLD,color:A.HEADER_PRIMARY},row:{flexDirection:"row",alignItems:"center"}});return t.createElement(g,{style:w.container},t.createElement(F,{value:a,onChange:u=>c(u),title:"Account Token"}),t.createElement(F,{value:l,onChange:u=>m(u),title:"Label"}),t.createElement(F,{value:d,onChange:u=>y(u),title:"Description"}),t.createElement(p,{label:()=>t.createElement(S,{adjustsFontSizeToFit:!0,style:w.colorText},"Color"),trailing:()=>t.createElement(g,{style:w.row},t.createElement(g,{style:[w.colorBlock,{backgroundColor:h}]}),t.createElement(S,{style:w.colorText},h),t.createElement(q,null)),onPress:()=>te({onSelect:u=>f(V.int2hex(u)),defaultColor:h})}),t.createElement(g,{style:w.row},t.createElement(G,{onPress:async function(){const u=await Q(a),P=e.get("accounts",[]);P[s]={token:a,user:u,label:l||null,description:d||null,color:h||null},e.set("accounts",P),n.goBack()},text:"Save account"})))}function ie({settings:e,navigation:n=C.useNavigation(),route:r=C.useRoute()}){const{token:i,user:s}=(r==null?void 0:r.params)||{},[a,c]=t.useState(i||""),[l,m]=t.useState(""),[d,y]=t.useState(""),[h,f]=t.useState("#524FBF"),w=L({container:{flex:1,padding:16},colorBlock:{minWidth:24,height:24,borderRadius:3,marginHorizontal:0,marginVertical:0,marginRight:8,justifyContent:"center",alignItems:"center"},colorText:{fontFamily:I.Fonts.PRIMARY_SEMIBOLD,color:A.HEADER_PRIMARY},row:{flexDirection:"row",alignItems:"center"}});return t.createElement(g,{style:w.container},t.createElement(F,{disabled:Boolean(i),value:i||"",onChange:u=>c(u),title:"Account Token"}),t.createElement(F,{onChange:u=>m(u),title:"Label"}),t.createElement(F,{onChange:u=>y(u),title:"Description"}),t.createElement(p,{label:()=>t.createElement(S,{adjustsFontSizeToFit:!0,style:w.colorText},"Color"),trailing:()=>t.createElement(g,{style:w.row},t.createElement(g,{style:[w.colorBlock,{backgroundColor:h}]}),t.createElement(S,{style:w.colorText},h),t.createElement(q,null)),onPress:()=>te({onSelect:u=>f(V.int2hex(u)),defaultColor:h})}),t.createElement(g,{style:w.row},t.createElement(G,{onPress:async function(){const u=s||await Q(a),P=e.get("accounts",[]);P.push({token:a,user:u,label:l||null,description:d||null,color:h||null}),e.set("accounts",P),n.goBack()},text:"Add account"})))}function ce({settings:e,navigation:n=C.useNavigation()}){return t.createElement(Pe,{settings:e,navigation:n})}function W({name:e="pluginName",mainScreen:n=ce,addAccount:r=ie}={}){const i=L({container:{backgroundColor:A.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:A.BACKGROUND_MOBILE_PRIMARY,color:A.TEXT_NORMAL},header:{backgroundColor:A.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:A.HEADER_PRIMARY},close:{color:A.HEADER_PRIMARY}});return t.createElement(C.NavigationContainer,{independent:!0},t.createElement(D.Navigator,{initialRouteName:e,style:i.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:i.cardStyle,headerStyle:i.header,headerTitleContainerStyle:i.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(D.Screen,{name:e,component:M(n,e),options:({navigation:s})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(fe,{color:i.close.color,title:"Close",onPress:()=>k.pop()}),headerRight:()=>t.createElement(oe,{navigation:s}),...X.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(D.Screen,{name:"AccountSwitcherAddAccount",component:M(r,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:i.close.color}}),t.createElement(D.Screen,{name:"AccountSwitcherEditAccount",component:M(re,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:i.close.color}})))}function xe(e){Be(e),_e(e)}function Be(e){e.after(Ee,"default",(n,r,i)=>({...i,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:M(ce,v.name),headerRight:oe},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:M(ie,v.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:M(re,v.name)}}))}function _e(e){const n=U("UserSettingsOverviewWrapper",{default:!1}),r=e.after(n,"default",(i,s,a)=>{const c=Y(a,l=>{var m;return((m=l.type)==null?void 0:m.name)==="UserSettingsOverview"});e.after(c.type.prototype,"render",({props:{navigation:l}},m,d)=>{const{children:y}=d.props,h=y.findIndex(f=>T.Messages.LOGOUT===f.props.label);y[h].props.label="Account Switcher",y[h].props.onPress=()=>{l.navigate("AccountSwitcherMain")}}),r()})}function Ne(e){const n=e.before(ee,"openLazy",({hideActionSheet:r},[i,s])=>{s==="StatusPicker"&&i.then(a=>{e.after(a,"default",(c,l,m)=>{const d=m.props.children[1].props.children.props.children;d.push({...d[0],props:{children:t.createElement(p,{leading:t.createElement(p.Icon,{source:E.Sort}),label:T.Messages.SWITCH_ACCOUNTS_MENU_ITEM_TITLE,trailing:p.Arrow,onPress:()=>{r(),k.push(W,{name:v.name})}})}})}),n()})})}const ae=U("Welcome",{default:!1}),_=me("account-switcher"),De={...v,onStart(){xe(_),Ne(_);const e=t.createElement(G,{onPress:()=>k.push(W,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(_.after(ae,"default",(r,i,s)=>{const a=Y(s,l=>{var m,d,y;return((y=(d=(m=l==null?void 0:l.children)==null?void 0:m[0])==null?void 0:d.type)==null?void 0:y.name)==="Button"});if(!a)return;const c=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(c)?c:[c],{marginBottom:12}],a.children.push(e)}),Boolean(b.getToken()))return;const n=_.before(g,"render",(r,[i],s)=>{const a=Y(i,c=>{var l;return((l=c==null?void 0:c.type)==null?void 0:l.name)==="Welcome"});!a||(a.type=ae.default,n())})},onStop(){_.unpatchAll()},getSettingsPanel({settings:e}){const n=C.useNavigation();return t.createElement(g,{onLayout:()=>{n.pop(),k.push(W,{name:v.name})}})}};le(De);
